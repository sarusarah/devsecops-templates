secrets-detection:
  stage: preflight
  image: zricethezav/gitleaks:v8.21.2
  script:
    - gitleaks detect --redact --source . --report-path gitleaks-report.json --report-format json --no-git
  rules:
    - if: '$ENABLE_SECRETS == "true"'
    - when: never
  allow_failure: false
  artifacts:
    when: always
    expire_in: 7 days
    paths:
      - gitleaks-report.json
